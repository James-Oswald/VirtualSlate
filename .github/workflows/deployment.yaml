name: Build VirtualSlate
on:
  push: {}
  pull_request: {}
jobs:
  Build-Extension:
    runs-on: ubuntu-latest
    steps:
     - name: Updates Packages
       run: sudo apt-get update
     - name: Install Scons
       run: sudo apt-get -y install scons gcc-mingw-w64
     - name: Install Compiler
       run: yes | sudo apt-get install g++-mingw-w64-x86-64
     - name: Get Repo
       uses: actions/checkout@v4
       with:
         submodules: recursive
     - name: Build Extension
       run: scons platform=windows
     - name: Upload Artifact
       uses: actions/upload-artifact@v3
       with:
          with: VirtualSlateBuildFiles
          path: ./
  Build-Game:
    runs-on: windows-latest
    needs: Build-Extension
    steps:
      - name: Retreive Build
        uses: actions/download-artifact@v3
        with:
          name: VirtualSlateBuildFiles
      - name: Download Engine
        run: Invoke-WebRequest https://downloads.tuxfamily.org/godotengine/4.1.2/Godot_v4.1.2-stable_win64.exe.zip -OutFile godotbuilder.zip
        working-directory: VirtualSlateBuildFiles
      - name: Make Game
        run: ./Godot_v4.1.2-stable_win64.exe --path project --headless --export-release "Windows Desktop"
        working-directory: VirtualSlateBuildFiles
      - name: Upload .exe
        uses: actions/upload-artifact@v3
        with:
          name: VirtualSlate-x64
          path: VirtualSlateBuildFiles/project/project.exe

